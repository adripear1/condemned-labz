{% comment %} This file is auto-generated. Do not edit this file. {% endcomment %}
{% liquid
  assign initial_store_data = block.settings.initial_store_data
%}

<template id='ss-alpine-support'>
  <script id='ss-alpine-cdn' src='https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js'></script>
  <script></script>
</template>

<!-- Dynamically inject Alpine.js -->
<script type='module'>
  function injectAlpine() {
  	const hasAlpineDirectives = !!document.querySelector('[x-data],[x-init]');
  	const hasAlpineCDN = !!document.querySelector('#ss-alpine-cdn.initialized');
  	if (hasAlpineDirectives && !hasAlpineCDN) {
  		// inject alpine cdn into the page
  		const alpineTemplateContents = document.querySelector('#ss-alpine-support')?.content;
  		if (alpineTemplateContents) {
  			alpineTemplateContents.querySelector('#ss-alpine-cdn').classList.add('initialized');
  			document.head.appendChild(alpineTemplateContents);
                 initGlobalStore();
  		}
  	}
  }

     function initGlobalStore() {
         document.addEventListener('alpine:init', () => {
             console.log('alpine initializing with data', '$store.global = ', {{ initial_store_data }});
             Alpine.store(
                 'global',
                 {{ initial_store_data }}
             )
         })
     }

  injectAlpine();
  ['shopify:section:load'].map((event) => document.addEventListener(event, injectAlpine));
</script>

<script></script>

{% schema %}
{
  "name": "AlpineJS Support",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "Enables [AlpineJS](https://alpinejs.dev/start-here) usage in the theme editor."
    },
    {
      "type": "header",
      "content": "Global Store"
    },
    {
      "type": "paragraph",
      "content": "A global store is created to store AlpineJS data. This is useful for storing data that needs to be accessed by multiple AlpineJS directives."
    },
    {
      "type": "paragraph",
      "content": "Store Name: `$store.global`"
    },
    {
      "type": "textarea",
      "id": "initial_store_data",
      "label": "Initial Store Data",
      "info": "This should be a JSON object.",
      "default": "{}"
    },
    {
      "type": "header",
      "content": "Performance Note"
    },
    {
      "type": "paragraph",
      "content": "AlpineJS is only downloaded when at least one AlpineJS directive is found on the page, otherwise it will not be downloaded and thus will not impact page load speed."
    }
  ],
  "presets": [
    {
      "name": "AlpineJS Support"
    }
  ]
}
{% endschema %}
